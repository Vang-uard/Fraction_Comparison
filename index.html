<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-J9V1XR626F"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-J9V1XR626F');
  </script>
  <meta name="google-adsense-account" content="ca-pub-9880204299534500">
  <title>GSAT ë°˜ë³µ ìˆ™ë‹¬</title>
  <style>
    /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
    body {
      font-family: Arial, sans-serif;
      margin: 20px auto;
      max-width: 800px;
      padding: 0 10px;
    }
    h1 {
      margin: 0;
    }
    /* ë„¤ë¹„ê²Œì´ì…˜ ë°” */
    .nav {
      text-align: center;
      margin-bottom: 20px;
    }
    .nav button {
      margin: 0 10px;
      padding: 10px 20px;
      font-size: 1em;
      cursor: pointer;
    }
    .nav .active {
      background-color: #007bff;
      color: white;
      border: none;
    }

    /* ë¶„ìˆ˜ ë¹„êµ ì—°ìŠµ í˜ì´ì§€ */
    #fraction-page {
      display: none;
    }
    .header {
      text-align: center;
      margin-bottom: 20px;
    }
    .fraction, .percentage {
      display: inline-block;
      text-align: center;
      margin: 0 10px;
      padding: 10px;
      border: 2px solid #ccc;
      border-radius: 4px;
      cursor: pointer;
      user-select: none;
      font-size: 1.2em;
    }
    .fraction .numerator {
      display: block;
      border-bottom: 1px solid #000;
      padding: 0 4px;
    }
    .fraction .denominator {
      display: block;
      padding: 0 4px;
    }
    .selected {
      background-color: #add8e6;
      border-color: #007bff;
    }
    .problem {
      margin-bottom: 15px;
      padding: 10px;
      border-bottom: 1px solid #ddd;
      text-align: center;
    }
    .controls {
      text-align: center;
      margin-top: 20px;
    }
    .controls button {
      margin: 0 10px;
      padding: 10px 20px;
      font-size: 1em;
      cursor: pointer;
    }
    .result {
      margin-top: 10px;
      font-weight: bold;
    }

    /* ê³±ì…ˆ ì—°ìŠµ í˜ì´ì§€ */
    #multiplication-page {
      display: none;
      margin-top: 40px;
    }
    .mul-header {
      text-align: center;
      margin-bottom: 20px;
    }
    .numbers-container {
      text-align: center;
    }
    .numbers {
      display: inline-block;
      text-align: right;
      font-family: "Courier New", Courier, monospace;
    }
    .number {
      display: block;
      font-size: 2em;
      line-height: 1.2;
    }
    .input-feedback-container {
      display: inline-block;
      text-align: right;
      margin-top: 10px;
    }
    .answer-input {
      font-size: 2em;
      text-align: right;
      width: 5ch;
      position: relative;
      left: 42px;
      font-family: "Courier New", Courier, monospace;
    }
    .feedback {
      display: inline-block;
      width: 24px;
      text-align: center;
      margin-left: 5px;
      position: relative;
      left: 30px;
    }
    input[type=number]::-webkit-outer-spin-button,
    input[type=number]::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    input[type=number] {
      -moz-appearance: textfield;
    }

    /* ëœë¤ë³€í™˜ í€´ì¦ˆ í˜ì´ì§€ */
    #random-transform-page {
      display: none;
      margin-top: 40px;
    }
    #rt-difficulty-container {
      text-align: center;
      margin-bottom: 10px;
    }
    #random-transform-display {
      text-align: center;
      font-size: 1.5em;
      margin: 20px;
    }
    #rt-low-inputs,
    #rt-high-inputs {
      text-align: center;
      margin: 10px;
    }
    #rt-low-inputs input[type="text"],
    #rt-high-inputs input[type="text"] {
      font-size: 1.2em;
      padding: 5px;
      width: 250px;
      margin-left: 10px;
    }
    #new-code-display {
      text-align: center;
      font-size: 1.5em;
      margin: 20px;
    }

    /* ì•ŒíŒŒë²³ ì™¸ìš°ê¸° í˜ì´ì§€ */
    #alphabet-page {
      display: none;
      margin-top: 40px;
    }
    #alpha-difficulty-container {
      text-align: center;
      margin-bottom: 20px;
    }
    #alpha-question {
      text-align: center;
      font-size: 2em;
      margin: 20px;
    }
    #alpha-answer-container {
      text-align: center;
      margin: 10px;
    }
    #alpha-answer {
      font-size: 1.2em;
      width: 100px;
      text-align: center;
      margin-left: 10px;
    }
    #alpha-feedback {
      display: block;
      text-align: center;
      font-weight: bold;
      margin-top: 10px;
      height: 1.5em; /* ì•„ì´ì½˜ ê³µê°„ í™•ë³´ */
    }
  </style>
</head>
<body>
  <!-- ë„¤ë¹„ê²Œì´ì…˜ ë°” -->
  <div class="nav">
    <button id="btn-fraction" class="active">ë¶„ìˆ˜ ë¹„êµ ì—°ìŠµ</button>
    <button id="btn-multiplication">ê³±ì…ˆ ì—°ìŠµ</button>
    <button id="btn-random-transform">ë„ì‹ ì¶”ë¦¬</button>
    <!-- ì•ŒíŒŒë²³ ì™¸ìš°ê¸° ë²„íŠ¼ -->
    <button id="btn-alphaquiz">ì•ŒíŒŒë²³ ì™¸ìš°ê¸°</button>
  </div>

  <!-- ë¶„ìˆ˜ ë¹„êµ ì—°ìŠµ í˜ì´ì§€ -->
  <div id="fraction-page">
    <div class="header">
      <h1>ë¶„ìˆ˜ ë¹„êµ ì—°ìŠµ</h1>
      <p>ë‚œì´ë„ë¥¼ ì„ íƒí•˜ë©´ ë°”ë¡œ ë¬¸ì œê°€ ìƒˆë¡œ ìƒì„±ë©ë‹ˆë‹¤.<br>
         ì•„ë˜ 15ë¬¸ì œì—ì„œ ë‘ ë¶„ìˆ˜ ì¤‘ ë” í° ë¶„ìˆ˜ë¥¼ í´ë¦­í•˜ì„¸ìš”.</p>
      <label><input type="radio" name="difficulty" value="hard"> ìƒ</label>
      <label><input type="radio" name="difficulty" value="medium" checked> ì¤‘</label>
      <label><input type="radio" name="difficulty" value="easy"> í•˜</label>
    </div>
    <div id="problems"></div>
    <div class="controls">
      <button id="refresh">ë¬¸ì œ ìƒˆë¡œê³ ì¹¨</button>
      <button id="grade">ì±„ì </button>
      <div class="result" id="result"></div>
    </div>
  </div>

  <!-- ê³±ì…ˆ ì—°ìŠµ í˜ì´ì§€ -->
  <div id="multiplication-page">
    <div class="mul-header">
      <h1>ê³±ì…ˆ ì—°ìŠµ</h1>
      <p>ì•„ë˜ì˜ ê³±ì…ˆ ë¬¸ì œë¥¼ í’€ê³  ì—”í„°í‚¤ë¡œ ì •ë‹µì„ ì œì¶œí•˜ì„¸ìš”.</p>
    </div>

    <!-- ê³±ì…ˆ ë²”ìœ„ ì„¤ì • UI -->
    <div style="text-align:center; margin-bottom:20px;">
      <label>ì²« ë²ˆì§¸ ìˆ˜ ë²”ìœ„:
        <input type="number" id="rangeAmin" value="2" style="width:60px;">
        ~
        <input type="number" id="rangeAmax" value="99" style="width:60px;">
      </label>
      <br><br>
      <label>ë‘ ë²ˆì§¸ ìˆ˜ ë²”ìœ„:
        <input type="number" id="rangeBmin" value="2" style="width:60px;">
        ~
        <input type="number" id="rangeBmax" value="19" style="width:60px;">
      </label>
    </div>

    <div class="numbers-container">
      <div class="numbers">
        <div id="lineA" class="number"></div>
        <div id="lineB" class="number"></div>
        <div class="input-feedback-container">
          <input type="number" id="answer-input" class="answer-input" placeholder="">
          <span id="feedback" class="feedback"></span>
        </div>
      </div>
    </div>
  </div>

  <!-- ëœë¤ë³€í™˜ í€´ì¦ˆ í˜ì´ì§€ -->
  <div id="random-transform-page">
    <div class="header">
      <h1>ë„ì‹ì¶”ë¦¬ í€´ì¦ˆ</h1>
      <p>ì˜ˆì‹œ ë³€í™˜ì„ ë³´ê³  ë‚œì´ë„ë¥¼ ì„ íƒí•˜ì„¸ìš”.</p>
    </div>
    <div id="rt-difficulty-container">
      ë‚œì´ë„:
      <label><input type="radio" name="rt-difficulty" value="ìƒ"> ìƒ</label>
      <label><input type="radio" name="rt-difficulty" value="í•˜" checked> í•˜</label>
    </div>
    <div id="random-transform-display"></div>
    <div id="rt-low-inputs">
      <div class="input-group">
        <label>ì¦ê°ë³€í™˜:</label>
        <input type="text" id="increment-input" placeholder="ì˜ˆ: 2 -1 3 -2">
      </div>
      <div class="input-group">
        <label>ìˆœì„œë³€í™˜:</label>
        <input type="text" id="order-input" placeholder="ì˜ˆ: 4213">
      </div>
    </div>
    <div id="rt-high-inputs" style="display:none;">
      <div id="new-code-display"></div>
      <div class="input-group">
        <label>ë³€í™˜ ê²°ê³¼:</label>
        <input type="text" id="high-answer-input" placeholder="ë³€í™˜ ê²°ê³¼ ì…ë ¥">
      </div>
    </div>
    <div style="text-align:center;">
      <button id="new-random-problem">ìƒˆ ë¬¸ì œ</button>
      <button id="grade-random-problem">ì±„ì </button>
    </div>
    <div id="random-feedback" style="text-align:center; font-weight:bold; margin-top:10px;"></div>
  </div>

  <!-- ì•ŒíŒŒë²³ ì™¸ìš°ê¸° í˜ì´ì§€ -->
  <div id="alphabet-page">
    <div class="header">
      <h1>ì•ŒíŒŒë²³ ì™¸ìš°ê¸°</h1>
    </div>
    <!-- ë‚œì´ë„ ì„ íƒ: ìƒ / ì¤‘ / í•˜ (ìˆœì„œëŒ€ë¡œ) -->
    <div id="alpha-difficulty-container" style="text-align:center;">
      ë‚œì´ë„:
      <label><input type="radio" name="alpha-difficulty" value="ìƒ"> ìƒ</label>
      <label><input type="radio" name="alpha-difficulty" value="ì¤‘"> ì¤‘</label>
      <label><input type="radio" name="alpha-difficulty" value="í•˜" checked> í•˜</label>
    </div>

    <div id="alpha-question"></div>

    <div id="alpha-answer-container">
      <label>ì •ë‹µ:</label>
      <input type="text" id="alpha-answer" placeholder="ë‹µ ì…ë ¥">
    </div>
    <div id="alpha-feedback"></div>
  </div>

  <script>
    /********************************************************
     *                   1) ë¶„ìˆ˜ ë¹„êµ ì—°ìŠµ
     ********************************************************/
    const MIN_DIFF_RATIO = 0.015; // 1.5%
    function randomNumber(isThreeDigit) {
      if (isThreeDigit) {
        return Math.floor(Math.random() * 900) + 100; // 100~999
      } else {
        return Math.floor(Math.random() * 9000) + 1000; // 1000~9999
      }
    }
    const presetPercentages = [5,5,15,15,20,20,25,25,30,35,50,50,70,70,75,75,80,80,85,110,115,120,120,125,125,150];
    function generateEasyFraction1() {
      const p = presetPercentages[Math.floor(Math.random() * presetPercentages.length)];
      const value1 = p / 100;
      const minDenom = Math.ceil(100 / value1);
      let denominator;
      const digitType = (Math.random() < 0.5 && minDenom <= 999) ? "3" : "4";
      if (digitType === "3") {
        do {
          denominator = randomNumber(true);
        } while (denominator < minDenom);
      } else {
        do {
          denominator = randomNumber(false);
        } while (denominator < minDenom);
      }
      let numerator = Math.round(value1 * denominator);
      if (numerator < 100) numerator = 100;
      return { frac: { numerator, denominator }, value: value1, preset: p };
    }
    function generateEasyFraction2(value1) {
      let attempts = 0;
      while (true) {
        attempts++;
        if (attempts > 1000) {
          let fallbackValue = value1 * 1.10;
          return generateEasyFraction2Core(fallbackValue);
        }
        const delta = (Math.random() * 2 - 1) * 0.10;
        const targetValue2 = value1 * (1 + delta);
        if (Math.abs(targetValue2 - value1) / value1 < MIN_DIFF_RATIO) {
          continue;
        }
        return generateEasyFraction2Core(targetValue2);
      }
    }
    function generateEasyFraction2Core(targetValue2) {
      const minDenom = Math.ceil(100 / targetValue2);
      const digitType = (Math.random() < 0.5 && minDenom <= 999) ? "3" : "4";
      let denominator;
      if (digitType === "3") {
        do {
          denominator = randomNumber(true);
        } while (denominator < minDenom);
      } else {
        do {
          denominator = randomNumber(false);
        } while (denominator < minDenom);
      }
      let numerator = Math.round(targetValue2 * denominator);
      if (numerator < 100) numerator = 100;
      return { numerator, denominator, value: targetValue2 };
    }
    function generateFraction() {
      return {
        numerator: (Math.random() < 0.5 ? randomNumber(true) : randomNumber(false)),
        denominator: (Math.random() < 0.5 ? randomNumber(true) : randomNumber(false))
      };
    }
    function generateCloseFractionValue(baseFraction, difficulty) {
      const baseValue = baseFraction.numerator / baseFraction.denominator;
      const errorRange = (difficulty === 'hard') ? 0.05 : 0.15;
      let attempts = 0;
      while (true) {
        attempts++;
        if (attempts > 1000) {
          return { numerator: baseFraction.numerator, denominator: baseFraction.denominator };
        }
        const error = (Math.random() * 2 - 1) * errorRange;
        const targetValue = baseValue * (1 + error);
        if (Math.abs(targetValue - baseValue) / baseValue < MIN_DIFF_RATIO) {
          continue;
        }
        const fraction2 = tryBuildFraction2(targetValue);
        if (fraction2) return fraction2;
      }
    }
    function tryBuildFraction2(targetValue) {
      for (let attempt = 0; attempt < 1000; attempt++) {
        let denomIs3 = Math.random() < 0.5;
        let denominator = denomIs3 ? Math.floor(Math.random() * 900) + 100 : Math.floor(Math.random() * 9000) + 1000;
        let numerator = Math.round(targetValue * denominator);
        if (numerator >= 100 && numerator <= 9999) {
          return { numerator, denominator };
        }
      }
      return null;
    }
    function generateProblem(difficulty) {
      let frac1, frac2, answer;
      if (difficulty === 'easy') {
        const result1 = generateEasyFraction1();
        frac1 = result1.frac;
        const value1 = result1.value;
        const preset = result1.preset;
        const result2 = generateEasyFraction2(value1);
        frac2 = { numerator: result2.numerator, denominator: result2.denominator };
        answer = (value1 > result2.value) ? "first" : "second";
        return { frac1, frac2, answer, userAnswer: null, difficulty, preset };
      } else {
        do { frac1 = generateFraction(); }
        while (frac1.numerator / frac1.denominator < 0.5 || frac1.numerator / frac1.denominator > 2);
        const fraction2 = generateCloseFractionValue(frac1, difficulty);
        frac2 = { numerator: fraction2.numerator, denominator: fraction2.denominator };
        const val1 = frac1.numerator / frac1.denominator;
        const val2 = frac2.numerator / frac2.denominator;
        answer = (val1 > val2) ? "first" : "second";
        return { frac1, frac2, answer, userAnswer: null, difficulty };
      }
    }
    let problems = [];
    function createFractionButton(fraction, problemIndex, fractionSide) {
      const problem = problems[problemIndex];
      if (problem.difficulty === 'easy' && fractionSide === "first") {
        const btn = document.createElement('div');
        btn.className = 'percentage';
        btn.textContent = problem.preset + "%";
        btn.addEventListener('click', function() {
          selectAnswer(problemIndex, btn, fractionSide);
        });
        return btn;
      } else {
        const btn = document.createElement('div');
        btn.className = 'fraction';
        const numSpan = document.createElement('span');
        numSpan.className = 'numerator';
        numSpan.textContent = fraction.numerator;
        btn.appendChild(numSpan);
        const denSpan = document.createElement('span');
        denSpan.className = 'denominator';
        denSpan.textContent = fraction.denominator;
        btn.appendChild(denSpan);
        btn.addEventListener('click', function() {
          selectAnswer(problemIndex, btn, fractionSide);
        });
        return btn;
      }
    }
    function selectAnswer(problemIndex, btn, fractionSide) {
      const problemDiv = document.getElementById('problem-' + problemIndex);
      const allButtons = problemDiv.querySelectorAll('.fraction, .percentage');
      allButtons.forEach(b => b.classList.remove('selected'));
      btn.classList.add('selected');
      problems[problemIndex].userAnswer = fractionSide;
    }
    function renderProblems() {
      const problemsDiv = document.getElementById('problems');
      problemsDiv.innerHTML = '';
      problems.forEach((problem, index) => {
        const div = document.createElement('div');
        div.className = 'problem';
        div.id = 'problem-' + index;
        const frac1Btn = createFractionButton(problem.frac1, index, "first");
        const frac2Btn = createFractionButton(problem.frac2, index, "second");
        div.appendChild(frac1Btn);
        div.appendChild(frac2Btn);
        problemsDiv.appendChild(div);
      });
    }
    function generateProblems() {
      const difficulty = document.querySelector('input[name="difficulty"]:checked').value;
      problems = [];
      for (let i = 0; i < 15; i++) {
        problems.push(generateProblem(difficulty));
      }
      renderProblems();
      document.getElementById('result').textContent = "";
    }
    function gradeProblems() {
      let correctCount = 0;
      problems.forEach((problem, index) => {
        const problemDiv = document.getElementById('problem-' + index);
        if (problem.userAnswer === problem.answer) {
          correctCount++;
          problemDiv.style.backgroundColor = '#d4edda';
        } else {
          problemDiv.style.backgroundColor = '#f8d7da';
        }
      });
      document.getElementById('result').textContent = "ì •ë‹µ: " + correctCount + " / 15";
    }
    document.getElementById('refresh').addEventListener('click', generateProblems);
    document.getElementById('grade').addEventListener('click', gradeProblems);
    document.querySelectorAll('input[name="difficulty"]').forEach(radio => {
      radio.addEventListener('change', generateProblems);
    });

    /********************************************************
     *                   2) ê³±ì…ˆ ì—°ìŠµ
     ********************************************************/
    let currentProblem = null; // ê³±ì…ˆ ë¬¸ì œ ì •ë³´
    function generateMulProblem() {
      const amin = parseInt(document.getElementById("rangeAmin").value, 10);
      const amax = parseInt(document.getElementById("rangeAmax").value, 10);
      const bmin = parseInt(document.getElementById("rangeBmin").value, 10);
      const bmax = parseInt(document.getElementById("rangeBmax").value, 10);

      let validA = (!isNaN(amin) && !isNaN(amax) && amin <= amax);
      let validB = (!isNaN(bmin) && !isNaN(bmax) && bmin <= bmax);

      let finalAmin = 2, finalAmax = 99;
      let finalBmin = 2, finalBmax = 19;

      if (!validA || !validB) {
        alert("ì…ë ¥í•œ ë²”ìœ„ê°€ ì˜¬ë°”ë¥´ì§€ ì•Šì•„ ê¸°ë³¸ê°’(2~99, 2~19)ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.");
      } else {
        finalAmin = amin;
        finalAmax = amax;
        finalBmin = bmin;
        finalBmax = bmax;
      }

      const a = Math.floor(Math.random() * (finalAmax - finalAmin + 1)) + finalAmin;
      const b = Math.floor(Math.random() * (finalBmax - finalBmin + 1)) + finalBmin;

      currentProblem = { a, b, answer: a * b };
      displayMulProblem();
    }
    function displayMulProblem() {
      const aStr = currentProblem.a.toString();
      const bStr = currentProblem.b.toString();
      const maxLen = Math.max(aStr.length, bStr.length);
      document.getElementById('lineA').textContent = aStr.padStart(maxLen, ' ');
      document.getElementById('lineB').textContent = bStr.padStart(maxLen, ' ');
      const inputElem = document.getElementById('answer-input');
      inputElem.value = '';
      inputElem.focus();
      document.getElementById('feedback').textContent = '';
    }
    function checkMulAnswer() {
      const inputElem = document.getElementById('answer-input');
      const feedbackElem = document.getElementById('feedback');
      const userAnswer = parseInt(inputElem.value, 10);
      if (userAnswer === currentProblem.answer) {
        feedbackElem.textContent = 'ğŸŸ¢';
        setTimeout(generateMulProblem, 500);
      } else {
        feedbackElem.textContent = 'âŒ';
        inputElem.focus();
      }
    }
    document.getElementById('answer-input').addEventListener('keydown', function(e) {
      if (e.key === 'Enter') {
        checkMulAnswer();
      }
    });

    /********************************************************
     *                   3) ëœë¤ë³€í™˜ í€´ì¦ˆ
     ********************************************************/
    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }
    function shiftLetter(letter, shift) {
      const alpha = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
      let index = alpha.indexOf(letter);
      index = (index + shift + 26) % 26;
      return alpha[index];
    }
    let currentTransformType;
    let currentOriginalCode = "";
    let currentTransformedCode = "";
    let expectedIncrementRule = "";
    let expectedOrderRule = "";
    let currentRTDifficulty = "í•˜";
    let currentIncrementTypes = [];
    let currentIncrementShifts = [];
    let expectedHighAnswer = "";

    function generateBasicCode() {
      let digits = [];
      while (digits.length < 2) {
        let d = Math.floor(Math.random() * 10);
        if (!digits.includes(d)) digits.push(d);
      }
      let letters = [];
      const alpha = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
      while (letters.length < 2) {
        let ch = alpha[Math.floor(Math.random()*26)];
        if (!letters.includes(ch)) letters.push(ch);
      }
      let codeArr = digits.concat(letters);
      shuffleArray(codeArr);
      return codeArr.join("");
    }
    function generateIncrementProblem() {
      let types = ["digit", "digit", "letter", "letter"];
      shuffleArray(types);
      let originalArr = [];
      let transformedArr = [];
      let incrementRules = [];
      const allowedShifts = [-4, -3, -2, -1, 1, 2, 3, 4];
      let chosenDigits = [];
      let chosenLetters = [];
      currentIncrementTypes = types.slice();
      for (let i = 0; i < 4; i++) {
        if (types[i] === "digit") {
          let valid = false, shift, origDigit;
          for (let attempt = 0; attempt < 100; attempt++) {
            shift = allowedShifts[Math.floor(Math.random() * allowedShifts.length)];
            let minVal = (shift < 0) ? Math.abs(shift) : 0;
            let maxVal = (shift > 0) ? (9 - shift) : 9;
            let possible = [];
            for (let d = minVal; d <= maxVal; d++) {
              if (!chosenDigits.includes(d)) possible.push(d);
            }
            if (possible.length > 0) {
              origDigit = possible[Math.floor(Math.random() * possible.length)];
              valid = true;
              break;
            }
          }
          if (!valid) {
            let possible = [];
            for (let d = 0; d <= 9; d++) {
              if (!chosenDigits.includes(d)) possible.push(d);
            }
            origDigit = possible[Math.floor(Math.random() * possible.length)];
            shift = 1;
          }
          chosenDigits.push(origDigit);
          originalArr.push(origDigit.toString());
          transformedArr.push((origDigit + shift).toString());
          incrementRules.push(shift);
        } else {
          const alpha = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
          let possibleLetters = [];
          for (let j = 0; j < alpha.length; j++) {
            let ch = alpha[j];
            if (!chosenLetters.includes(ch)) possibleLetters.push(ch);
          }
          let origLetter = possibleLetters[Math.floor(Math.random() * possibleLetters.length)];
          chosenLetters.push(origLetter);
          let shift = allowedShifts[Math.floor(Math.random() * allowedShifts.length)];
          originalArr.push(origLetter);
          transformedArr.push(shiftLetter(origLetter, shift));
          incrementRules.push(shift);
        }
      }
      currentOriginalCode = originalArr.join("");
      currentTransformedCode = transformedArr.join("");
      expectedIncrementRule = incrementRules.map(v => v.toString()).join(" ");
      currentIncrementShifts = incrementRules.slice();
    }
    function generateOrderProblem() {
      currentOriginalCode = generateBasicCode();
      let positions;
      let validPermutation = false;
      while (!validPermutation) {
        positions = [1, 2, 3, 4];
        shuffleArray(positions);
        let diffCount = positions.reduce((count, pos, idx) => {
          return count + (pos !== idx + 1 ? 1 : 0);
        }, 0);
        if (diffCount >= 3) validPermutation = true;
      }
      expectedOrderRule = positions.join("");
      let originalArr = currentOriginalCode.split("");
      currentTransformedCode = positions.map(pos => originalArr[pos - 1]).join("");
    }
    function generateNewIncrementForHigh() {
      let newOriginalArr = [];
      let newTransformedArr = [];
      const allowedShifts = currentIncrementShifts;
      let chosenDigits = [];
      let chosenLetters = [];
      const alpha = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
      for (let i = 0; i < 4; i++) {
        if (currentIncrementTypes[i] === "digit") {
          let shift = allowedShifts[i];
          let minVal = (shift < 0) ? Math.abs(shift) : 0;
          let maxVal = (shift > 0) ? (9 - shift) : 9;
          let possible = [];
          for (let d = minVal; d <= maxVal; d++) {
            if (!chosenDigits.includes(d)) possible.push(d);
          }
          if (possible.length === 0) {
            for (let d = 0; d <= 9; d++) {
              if (!chosenDigits.includes(d)) possible.push(d);
            }
          }
          let origDigit = possible[Math.floor(Math.random() * possible.length)];
          chosenDigits.push(origDigit);
          newOriginalArr.push(origDigit.toString());
          newTransformedArr.push((origDigit + shift).toString());
        } else {
          let possibleLetters = [];
          for (let j = 0; j < alpha.length; j++) {
            let ch = alpha[j];
            if (!chosenLetters.includes(ch)) possibleLetters.push(ch);
          }
          let origLetter = possibleLetters[Math.floor(Math.random() * possibleLetters.length)];
          chosenLetters.push(origLetter);
          newOriginalArr.push(origLetter);
          let shift = currentIncrementShifts[i];
          newTransformedArr.push(shiftLetter(origLetter, shift));
        }
      }
      return {
        original: newOriginalArr.join(""),
        transformed: newTransformedArr.join("")
      };
    }
    function generateNewOrderForHigh() {
      let newOriginal = generateBasicCode();
      let originalArr = newOriginal.split("");
      let newTransformed = expectedOrderRule.split("").map(pos => originalArr[pos - 1]).join("");
      return { original: newOriginal, transformed: newTransformed };
    }
    function generateRandomTransformProblem() {
      currentRTDifficulty = document.querySelector('input[name="rt-difficulty"]:checked').value;
      if (currentRTDifficulty === "í•˜") {
        document.getElementById("rt-low-inputs").style.display = "block";
        document.getElementById("rt-high-inputs").style.display = "none";
        currentTransformType = (Math.random() < 0.5) ? "ì¦ê°" : "ìˆœì„œ";
        if (currentTransformType === "ì¦ê°") {
          generateIncrementProblem();
        } else {
          generateOrderProblem();
        }
        document.getElementById("random-transform-display").textContent = currentOriginalCode + " â†’ " + currentTransformedCode;
        document.getElementById("increment-input").value = "";
        document.getElementById("order-input").value = "";
      } else {
        document.getElementById("rt-low-inputs").style.display = "none";
        document.getElementById("rt-high-inputs").style.display = "block";
        currentTransformType = (Math.random() < 0.5) ? "ì¦ê°" : "ìˆœì„œ";
        if (currentTransformType === "ì¦ê°") {
          generateIncrementProblem();
          document.getElementById("random-transform-display").textContent = currentOriginalCode + " â†’ " + currentTransformedCode;
          const newPair = generateNewIncrementForHigh();
          document.getElementById("new-code-display").textContent = newPair.original + " â†’ ?";
          expectedHighAnswer = newPair.transformed;
        } else {
          generateOrderProblem();
          document.getElementById("random-transform-display").textContent = currentOriginalCode + " â†’ " + currentTransformedCode;
          const newPair = generateNewOrderForHigh();
          document.getElementById("new-code-display").textContent = newPair.original + " â†’ ?";
          expectedHighAnswer = newPair.transformed;
        }
        document.getElementById("high-answer-input").value = "";
      }
      document.getElementById("random-feedback").textContent = "";
    }
    document.getElementById("increment-input").addEventListener("keydown", function(e) {
      if (e.key === "Enter") {
        gradeRandomTransformProblem();
      }
    });
    document.getElementById("order-input").addEventListener("keydown", function(e) {
      if (e.key === "Enter") {
        gradeRandomTransformProblem();
      }
    });
    document.getElementById("high-answer-input").addEventListener("keydown", function(e) {
      if (e.key === "Enter") {
        gradeRandomTransformProblem();
      }
    });
    function gradeRandomTransformProblem() {
      let feedback = "";
      if (currentRTDifficulty === "í•˜") {
        if (currentTransformType === "ì¦ê°") {
          let userInput = document.getElementById("increment-input").value.trim();
          let userRules = userInput.split(/\s+/);
          let expectedRules = expectedIncrementRule.split(" ");
          if (userRules.length !== 4) {
            feedback = "ì¦ê°ë³€í™˜ ë‹µì€ 4ê°œì˜ ìˆ«ìë¥¼ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.";
          } else {
            let correct = true;
            for (let i = 0; i < 4; i++) {
              if (parseInt(userRules[i], 10) !== parseInt(expectedRules[i], 10)) {
                correct = false;
                break;
              }
            }
            if (correct) {
              feedback = "ğŸŸ¢";
              document.getElementById("random-feedback").textContent = feedback;
              setTimeout(generateRandomTransformProblem, 300);
              return;
            } else {
              feedback = "âŒ ì˜¤ë‹µ. ì •ë‹µ: " + expectedIncrementRule;
            }
          }
        } else {
          let userInput = document.getElementById("order-input").value.trim();
          if (userInput === expectedOrderRule) {
            feedback = "ğŸŸ¢";
            document.getElementById("random-feedback").textContent = feedback;
            setTimeout(generateRandomTransformProblem, 300);
            return;
          } else {
            feedback = "âŒ ì˜¤ë‹µ. ì •ë‹µ: " + expectedOrderRule;
          }
        }
      } else {
        let userInput = document.getElementById("high-answer-input").value.trim();
        if (userInput === expectedHighAnswer) {
          feedback = "ğŸŸ¢";
          document.getElementById("random-feedback").textContent = feedback;
          setTimeout(generateRandomTransformProblem, 300);
          return;
        } else {
          feedback = "âŒ ì˜¤ë‹µ. ì •ë‹µ: " + expectedHighAnswer;
        }
      }
      document.getElementById("random-feedback").textContent = feedback;
    }
    document.querySelectorAll('input[name="rt-difficulty"]').forEach(radio => {
      radio.addEventListener("change", generateRandomTransformProblem);
    });

    /********************************************************
     *                   4) ì•ŒíŒŒë²³ ì™¸ìš°ê¸°
     ********************************************************/
    // ë‚œì´ë„:
    //   í•˜: ì•ŒíŒŒë²³ í•œ ê¸€ì => Aâ†’1 (ì‚¬ìš©ìì—ê²Œ ìˆ«ìë¥¼ ì…ë ¥í•˜ê²Œ í•¨)
    //   ì¤‘: ìˆ«ì(1~26) => 1 => A (ì‚¬ìš©ìì—ê²Œ ì•ŒíŒŒë²³ì„ ì…ë ¥)
    //   ìƒ: ì•ŒíŒŒë²³ - ì•ŒíŒŒë²³ => -1 ë“±
    //
    //   + ìµœê·¼ 10ë¬¸ì œ ì¤‘ë³µ ë°©ì§€ (ì¤‘, í•˜)

    let alphaDifficulty = "í•˜";
    let currentAlphaQuestion = ""; // ì˜ˆ: "A" or "A - B" or "13"
    let currentAlphaAnswer = "";   // ì˜ˆ: "1", "-1", "M"
    
    // ìµœê·¼ 10ë¬¸ì œ (í•˜, ì¤‘ë§Œ ê´€ë¦¬; ìƒì€ ì¤‘ë³µ ë°©ì§€ X)
    //   - í•˜ => ì €ì¥í•  ê°’: letter ì¸ë±ìŠ¤ (0~25)
    //   - ì¤‘ => ì €ì¥í•  ê°’: number (1~26)
    let recentAlphaLower = []; // í•˜ (letter index)
    let recentAlphaMid = [];   // ì¤‘ (1~26)

    function generateAlphaProblem() {
      const inputElem = document.getElementById('alpha-answer');
      alphaDifficulty = document.querySelector('input[name="alpha-difficulty"]:checked').value;
        if (alphaDifficulty === "í•˜") {
    inputElem.placeholder = "ìˆ«ì ì…ë ¥";
  } else if (alphaDifficulty === "ì¤‘") {
    inputElem.placeholder = "ì•ŒíŒŒë²³ ì…ë ¥";
  } else { // ìƒ
    inputElem.placeholder = "ì•ŒíŒŒë²³ ì…ë ¥";
  }
      const alpha = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";

      if (alphaDifficulty === "í•˜") {
        // í•˜: í•œ ì•ŒíŒŒë²³ì„ í‘œì‹œ => ë‹µì€ ê·¸ ì•ŒíŒŒë²³ì˜ ë²ˆí˜¸(1~26)
        inputElem.placeholder = "ìˆ«ì ì…ë ¥";
        let maxAttempts = 1000;
        let idx = -1;
        for (let attempt=0; attempt<maxAttempts; attempt++){
          let candidate = Math.floor(Math.random()*26); // 0~25
          if (!recentAlphaLower.includes(candidate)) {
            idx = candidate;
            break;
          }
        }
        if (idx<0) {
          // ë§Œì•½ 1000ë²ˆ ì•ˆì— ëª»ì°¾ìœ¼ë©´ ê·¸ëƒ¥ ëœë¤
          idx = Math.floor(Math.random()*26);
        }
        // ê°±ì‹ : recentAlphaLower
        recentAlphaLower.push(idx);
        if (recentAlphaLower.length>10) {
          recentAlphaLower.shift(); // 10ê°œ ì´ˆê³¼ì‹œ ë§¨ ì• ì œê±°
        }

        let letter = alpha[idx];
        currentAlphaQuestion = letter; 
        currentAlphaAnswer = (idx+1).toString(); 
        document.getElementById("alpha-question").textContent = letter + " â†’ ?";
      }
      else if (alphaDifficulty === "ì¤‘") {
      // 1) í•¨ìˆ˜ ì†ì„±ìœ¼ë¡œ í† ê¸€ ìƒíƒœ ì €ì¥
      if (typeof generateAlphaProblem.midToggle === 'undefined') {
      generateAlphaProblem.midToggle = true; // ì²«ì—” ë§ì…ˆ
    }
    const sign = generateAlphaProblem.midToggle ? '+' : '-';
    generateAlphaProblem.midToggle = !generateAlphaProblem.midToggle;

    // 2) shift ê°’ (1~5)
    const shift = Math.floor(Math.random() * 5) + 1;

    // 3) baseIdx ë²”ìœ„ ì¡°ì •
    let baseIdx;
    if (sign === '+') {
      // ë§ì…ˆì´ë©´ A(0)~U(20) ë²”ìœ„ì—ì„œë§Œ
      baseIdx = Math.floor(Math.random() * 21); // 0..20
    } else {
      // ëº„ì…ˆì´ë©´ F(5)~Z(25) ë²”ìœ„ì—ì„œë§Œ
      baseIdx = Math.floor(Math.random() * 21) + 5; // 5..25
    }
    const baseLetter = alpha[baseIdx];

    // 4) ê²°ê³¼ ì¸ë±ìŠ¤ ê³„ì‚° (ëª¨ë“ˆë¡œ ë¶ˆí•„ìš”)
    const resultIdx = sign === '+'
      ? baseIdx + shift       // í•­ìƒ <= 20+5=25
      : baseIdx - shift;      // í•­ìƒ >= 5-5=0

    currentAlphaQuestion = `${baseLetter} ${sign} ${shift} = ?`;
    currentAlphaAnswer   = alpha[resultIdx];
    document.getElementById("alpha-question").textContent = currentAlphaQuestion;
      }
      else {
  // 1) shift í¬ê¸° (1~5) ê²°ì •í•˜ê³ , ë¶€í˜¸ ëœë¤
  const magnitude = Math.floor(Math.random() * 5) + 1;      // 1..5
  const sign      = Math.random() < 0.5 ?  1 : -1;         // + ë˜ëŠ” â€“
  const shift     = magnitude * sign;                      // ì˜ˆ: -3, +5 ë“±

  // 2) baseIdx ë²”ìœ„ ì¡°ì •
  let baseIdx;
  if (shift > 0) {
    // ë”í•˜ê¸°ë©´ A(0)ë¶€í„° Z-shift ê¹Œì§€
    baseIdx = Math.floor(Math.random() * (26 - shift));
  } else {
    // ë¹¼ê¸°ë©´ |shift| ë¶€í„° Z(25)ê¹Œì§€
    baseIdx = Math.floor(Math.random() * (26 - Math.abs(shift))) + Math.abs(shift);
  }

  // 3) ë‘ ê°œì˜ ì„œë¡œ ë‹¤ë¥¸ ì¸ë±ìŠ¤ ë½‘ê¸° (ì˜ˆì‹œ/ë¬¸ì œìš©)
  let idx1 = baseIdx;
  let idx2;
  do {
    // ë¬¸ì œìš© ì¸ë±ìŠ¤ë„ ê°™ì€ ë²”ìœ„ ë‚´ì—ì„œ ëœë¤
    idx2 = shift > 0
      ? Math.floor(Math.random() * (26 - shift))
      : Math.floor(Math.random() * (26 - Math.abs(shift))) + Math.abs(shift);
  } while (idx2 === idx1);

  // 4) ë¬¸ì ìƒì„±
  const alpha = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
  const letter1      = alpha[idx1];
  const letter1Shift = alpha[idx1 + shift];
  const letter2      = alpha[idx2];
  const letter2Shift = alpha[idx2 + shift];

  // 5) í™”ë©´ì—
  const qElem = document.getElementById("alpha-question");
  qElem.style.whiteSpace = "pre";
  qElem.textContent = 
    `${letter1} â†’ ${letter1Shift}\n` +
    `${letter2} â†’ ?`;

  // 6) ì •ë‹µ ì €ì¥
  currentAlphaAnswer = letter2Shift;
      }

      document.getElementById("alpha-answer").value = "";
      document.getElementById("alpha-feedback").textContent = "";
      document.getElementById("alpha-answer").focus();



    }

    // ì±„ì 
    function checkAlphaAnswer() {
      let user = document.getElementById("alpha-answer")
                  .value
                  .trim()
                  .toUpperCase();
      let feedbackElem = document.getElementById("alpha-feedback");
      if (user === currentAlphaAnswer) {
        feedbackElem.textContent = "ğŸŸ¢";
        setTimeout(generateAlphaProblem, 300);
      } else {
        feedbackElem.textContent = "âŒ";
        document.getElementById("alpha-answer").focus();
      }
    }
    document.getElementById("alpha-answer").addEventListener("keydown", function(e) {
      if (e.key === "Enter") {
        checkAlphaAnswer();
      }
    });
    document.querySelectorAll('input[name="alpha-difficulty"]').forEach(radio => {
      radio.addEventListener("change", generateAlphaProblem);
    });

    /********************************************************
     *                   í˜ì´ì§€ ì „í™˜ í•¨ìˆ˜ë“¤
     ********************************************************/
    function showFractionPage() {
      document.getElementById("fraction-page").style.display = "block";
      document.getElementById("multiplication-page").style.display = "none";
      document.getElementById("random-transform-page").style.display = "none";
      document.getElementById("alphabet-page").style.display = "none";

      document.getElementById("btn-fraction").classList.add("active");
      document.getElementById("btn-multiplication").classList.remove("active");
      document.getElementById("btn-random-transform").classList.remove("active");
      document.getElementById("btn-alphaquiz").classList.remove("active");

      generateProblems();
    }
    function showMultiplicationPage() {
      document.getElementById("fraction-page").style.display = "none";
      document.getElementById("multiplication-page").style.display = "block";
      document.getElementById("random-transform-page").style.display = "none";
      document.getElementById("alphabet-page").style.display = "none";

      document.getElementById("btn-multiplication").classList.add("active");
      document.getElementById("btn-fraction").classList.remove("active");
      document.getElementById("btn-random-transform").classList.remove("active");
      document.getElementById("btn-alphaquiz").classList.remove("active");

      generateMulProblem();
    }
    function showRandomTransformPage() {
      document.getElementById("fraction-page").style.display = "none";
      document.getElementById("multiplication-page").style.display = "none";
      document.getElementById("alphabet-page").style.display = "none";
      document.getElementById("random-transform-page").style.display = "block";

      document.getElementById("btn-random-transform").classList.add("active");
      document.getElementById("btn-fraction").classList.remove("active");
      document.getElementById("btn-multiplication").classList.remove("active");
      document.getElementById("btn-alphaquiz").classList.remove("active");

      generateRandomTransformProblem();
    }
    function showAlphaQuizPage() {
      document.getElementById("fraction-page").style.display = "none";
      document.getElementById("multiplication-page").style.display = "none";
      document.getElementById("random-transform-page").style.display = "none";
      document.getElementById("alphabet-page").style.display = "block";

      document.getElementById("btn-alphaquiz").classList.add("active");
      document.getElementById("btn-fraction").classList.remove("active");
      document.getElementById("btn-multiplication").classList.remove("active");
      document.getElementById("btn-random-transform").classList.remove("active");

      generateAlphaProblem();
    }

    // ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼
    document.getElementById("btn-fraction").addEventListener("click", showFractionPage);
    document.getElementById("btn-multiplication").addEventListener("click", showMultiplicationPage);
    document.getElementById("btn-random-transform").addEventListener("click", showRandomTransformPage);
    document.getElementById("btn-alphaquiz").addEventListener("click", showAlphaQuizPage);

    // ëœë¤ë³€í™˜ í˜ì´ì§€ ë‚´ ìƒˆ ë¬¸ì œ, ì±„ì  ë²„íŠ¼
    document.getElementById("new-random-problem").addEventListener("click", generateRandomTransformProblem);
    document.getElementById("grade-random-problem").addEventListener("click", gradeRandomTransformProblem);

    // ì²« ì§„ì… ì‹œ, ë¶„ìˆ˜ ë¹„êµ ì—°ìŠµ í˜ì´ì§€ë¥¼ ê¸°ë³¸ìœ¼ë¡œ
    showFractionPage();
  </script>
    <!-- ì—¬ê¸°ì— ì„¤ë¬¸ì¡°ì‚¬ ì„¹ì…˜ì„ ì¶”ê°€í•˜ì„¸ìš” -->
    <div id="survey" style="text-align:center; margin:40px 0;">
     
      <a href="https://forms.gle/V1YgxGrNPdaRg2on7" 
         target="_blank" 
         style="
           display:inline-block;
           padding:6px 12px;
           background-color:#a8c5f4;
           color:white;
           text-decoration:none;
           border-radius:4px;
           font-size:0.5em;
         ">
        ì˜ê²¬ ìˆ˜ë ´
      </a>
    </div>
</body>
</html>
