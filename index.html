<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-J9V1XR626F"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-J9V1XR626F');
  </script>
  <meta name="google-adsense-account" content="ca-pub-9880204299534500">
  <title>ìˆ˜í•™ ê³„ì‚° ì—°ìŠµ</title>
  <style>
    /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
    body {
      font-family: Arial, sans-serif;
      margin: 20px auto;
      max-width: 800px;
      padding: 0 10px;
    }
    h1 {
      margin: 0;
    }
    /* ë„¤ë¹„ê²Œì´ì…˜ ë°” */
    .nav {
      text-align: center;
      margin-bottom: 20px;
    }
    .nav button {
      margin: 0 10px;
      padding: 10px 20px;
      font-size: 1em;
      cursor: pointer;
    }
    .nav .active {
      background-color: #007bff;
      color: white;
      border: none;
    }
    /* ë¶„ìˆ˜ ë¹„êµ ì—°ìŠµ í˜ì´ì§€ */
    #fraction-page {
      display: none;
    }
    .header {
      text-align: center;
      margin-bottom: 20px;
    }
    .fraction, .percentage {
      display: inline-block;
      text-align: center;
      margin: 0 10px;
      padding: 10px;
      border: 2px solid #ccc;
      border-radius: 4px;
      cursor: pointer;
      user-select: none;
      font-size: 1.2em;
    }
    .fraction .numerator {
      display: block;
      border-bottom: 1px solid #000;
      padding: 0 4px;
    }
    .fraction .denominator {
      display: block;
      padding: 0 4px;
    }
    .selected {
      background-color: #add8e6;
      border-color: #007bff;
    }
    .problem {
      margin-bottom: 15px;
      padding: 10px;
      border-bottom: 1px solid #ddd;
      text-align: center;
    }
    .controls {
      text-align: center;
      margin-top: 20px;
    }
    .controls button {
      margin: 0 10px;
      padding: 10px 20px;
      font-size: 1em;
      cursor: pointer;
    }
    .result {
      margin-top: 10px;
      font-weight: bold;
    }
    /* ê³±ì…ˆ ì—°ìŠµ í˜ì´ì§€ */
    #multiplication-page {
      display: none;
      margin-top: 40px;
    }
    .mul-header {
      text-align: center;
      margin-bottom: 20px;
    }
    .numbers-container {
      text-align: center;
    }
    .numbers {
      display: inline-block;
      text-align: right;  /* ë‚´ë¶€ì˜ ìˆ«ìì™€ ì…ë ¥ë€ì„ ì˜¤ë¥¸ìª½ ì •ë ¬ */
      font-family: "Courier New", Courier, monospace; /* ëª¨ë…¸ìŠ¤í˜ì´ìŠ¤ í°íŠ¸ë¡œ ìë¦¿ìˆ˜ ì¼ì¹˜ */
    }
    .number {
      display: block;
      font-size: 2em;
      line-height: 1.2;
    }
    .input-feedback-container {
      display: inline-block;
      text-align: right;
      margin-top: 10px;
    }
    /* ì…ë ¥ë€ì€ ê³ ì • í­(5ch)ìœ¼ë¡œ ì„¤ì •í•˜ì—¬ ë¬¸ì œë§ˆë‹¤ í­ì´ ë³€í•˜ì§€ ì•ŠìŒ */
    .answer-input {
      font-size: 2em;
      text-align: right;
      width: 5ch;
      position: relative;
      left: 42px;  
      font-family: "Courier New", Courier, monospace;

    }
    /* í”¼ë“œë°± ì•„ì´ì½˜ ì˜ì—­ì— ê³ ì • í­(24px)ì„ ë¶€ì—¬ */
    .feedback {
      display: inline-block;
      width: 24px;
      text-align: center;
      margin-left: 5px;
      position: relative;
      left: 30px;  
    }
    /* ìŠ¤í”¼ë„ˆ ì œê±° (Chrome, Safari, Edge, Opera) */
    input[type=number]::-webkit-outer-spin-button,
    input[type=number]::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    /* ìŠ¤í”¼ë„ˆ ì œê±° (Firefox) */
    input[type=number] {
      -moz-appearance: textfield;
    }
  </style>
</head>
<body>
  <!-- ë„¤ë¹„ê²Œì´ì…˜ ë°” -->
  <div class="nav">
    <button id="btn-fraction" class="active">ë¶„ìˆ˜ ë¹„êµ ì—°ìŠµ</button>
    <button id="btn-multiplication">ê³±ì…ˆ ì—°ìŠµ</button>
  </div>

  <!-- ë¶„ìˆ˜ ë¹„êµ ì—°ìŠµ í˜ì´ì§€ -->
  <div id="fraction-page">
    <div class="header">
      <h1>ë¶„ìˆ˜ ë¹„êµ ì—°ìŠµ</h1>
      <p>ë‚œì´ë„ë¥¼ ì„ íƒí•˜ë©´ ë°”ë¡œ ë¬¸ì œê°€ ìƒˆë¡œ ìƒì„±ë©ë‹ˆë‹¤.<br>
         ì•„ë˜ 15ë¬¸ì œì—ì„œ ë‘ ë¶„ìˆ˜ ì¤‘ ë” í° ë¶„ìˆ˜ë¥¼ í´ë¦­í•˜ì„¸ìš”.</p>
      <label><input type="radio" name="difficulty" value="hard"> ìƒ</label>
      <label><input type="radio" name="difficulty" value="medium" checked> ì¤‘</label>
      <label><input type="radio" name="difficulty" value="easy"> í•˜</label>
    </div>
    <div id="problems"></div>
    <div class="controls">
      <button id="refresh">ë¬¸ì œ ìƒˆë¡œê³ ì¹¨</button>
      <button id="grade">ì±„ì </button>
      <div class="result" id="result"></div>
    </div>
  </div>

  <!-- ê³±ì…ˆ ì—°ìŠµ í˜ì´ì§€ -->
  <div id="multiplication-page">
    <div class="mul-header">
      <h1>ê³±ì…ˆ ì—°ìŠµ</h1>
      <p>ì•„ë˜ì˜ ê³±ì…ˆ ë¬¸ì œë¥¼ í’€ê³  ì—”í„°í‚¤ë¡œ ì •ë‹µì„ ì œì¶œí•˜ì„¸ìš”.</p>
    </div>
    <div class="numbers-container">
      <div class="numbers">
        <div id="lineA" class="number"></div>
        <div id="lineB" class="number"></div>
        <div class="input-feedback-container">
          <input type="number" id="answer-input" class="answer-input" placeholder="">
          <span id="feedback" class="feedback"></span>
        </div>
      </div>
    </div>
  </div>

  <script>
    /* ---------- í˜ì´ì§€ ì „í™˜ ê¸°ëŠ¥ ---------- */
    function showFractionPage() {
      document.getElementById('fraction-page').style.display = 'block';
      document.getElementById('multiplication-page').style.display = 'none';
      document.getElementById('btn-fraction').classList.add('active');
      document.getElementById('btn-multiplication').classList.remove('active');
      generateProblems();
    }
    function showMultiplicationPage() {
      document.getElementById('fraction-page').style.display = 'none';
      document.getElementById('multiplication-page').style.display = 'block';
      document.getElementById('btn-multiplication').classList.add('active');
      document.getElementById('btn-fraction').classList.remove('active');
      generateMulProblem();
    }
    document.getElementById('btn-fraction').addEventListener('click', showFractionPage);
    document.getElementById('btn-multiplication').addEventListener('click', showMultiplicationPage);

    /* ---------- ë¶„ìˆ˜ ë¹„êµ ì—°ìŠµ í˜ì´ì§€ ìŠ¤í¬ë¦½íŠ¸ ---------- */
    const MIN_DIFF_RATIO = 0.015; // 1.5%
    function randomNumber(isThreeDigit) {
      if (isThreeDigit) {
        return Math.floor(Math.random() * 900) + 100; // 100 ~ 999
      } else {
        return Math.floor(Math.random() * 9000) + 1000; // 1000 ~ 9999
      }
    }
    const presetPercentages = [5,15,20,25,50,75,80,85,110,115,120,125,150];
    function generateEasyFraction1() {
      const p = presetPercentages[Math.floor(Math.random() * presetPercentages.length)];
      const value1 = p / 100;
      const minDenom = Math.ceil(100 / value1);
      let denominator;
      const digitType = (Math.random() < 0.5 && minDenom <= 999) ? "3" : "4";
      if (digitType === "3") {
        do {
          denominator = randomNumber(true);
        } while (denominator < minDenom);
      } else {
        do {
          denominator = randomNumber(false);
        } while (denominator < minDenom);
      }
      let numerator = Math.round(value1 * denominator);
      if (numerator < 100) numerator = 100;
      return { frac: { numerator, denominator }, value: value1, preset: p };
    }
    function generateEasyFraction2(value1) {
      let attempts = 0;
      while (true) {
        attempts++;
        if (attempts > 1000) {
          let fallbackValue = value1 * 1.10;
          return generateEasyFraction2Core(fallbackValue);
        }
        const delta = (Math.random() * 2 - 1) * 0.10;
        const targetValue2 = value1 * (1 + delta);
        if (Math.abs(targetValue2 - value1) / value1 < MIN_DIFF_RATIO) {
          continue;
        }
        return generateEasyFraction2Core(targetValue2);
      }
    }
    function generateEasyFraction2Core(targetValue2) {
      const minDenom = Math.ceil(100 / targetValue2);
      const digitType = (Math.random() < 0.5 && minDenom <= 999) ? "3" : "4";
      let denominator;
      if (digitType === "3") {
        do {
          denominator = randomNumber(true);
        } while (denominator < minDenom);
      } else {
        do {
          denominator = randomNumber(false);
        } while (denominator < minDenom);
      }
      let numerator = Math.round(targetValue2 * denominator);
      if (numerator < 100) numerator = 100;
      return { numerator, denominator, value: targetValue2 };
    }
    function generateFraction() {
      return {
        numerator: (Math.random() < 0.5 ? randomNumber(true) : randomNumber(false)),
        denominator: (Math.random() < 0.5 ? randomNumber(true) : randomNumber(false))
      };
    }
    function generateCloseFractionValue(baseFraction, difficulty) {
      const baseValue = baseFraction.numerator / baseFraction.denominator;
      const errorRange = (difficulty === 'hard') ? 0.05 : 0.15;
      let attempts = 0;
      while (true) {
        attempts++;
        if (attempts > 1000) {
          return { numerator: baseFraction.numerator, denominator: baseFraction.denominator };
        }
        const error = (Math.random() * 2 - 1) * errorRange;
        const targetValue = baseValue * (1 + error);
        if (Math.abs(targetValue - baseValue) / baseValue < MIN_DIFF_RATIO) {
          continue;
        }
        const fraction2 = tryBuildFraction2(targetValue, baseFraction);
        if (fraction2) return fraction2;
      }
    }
    function tryBuildFraction2(targetValue, baseFraction) {
      let attempts2 = 0;
      while (attempts2 < 1000) {
        attempts2++;
        const forceCross = Math.random() < 0.8;
        if (forceCross) {
          if (Math.random() < 0.5) {
            const denominator = randomNumber(false);
            const numerator = Math.round(targetValue * denominator);
            if (numerator >= 100 && numerator <= 999) return { numerator, denominator };
          } else {
            const denominator = randomNumber(true);
            const numerator = Math.round(targetValue * denominator);
            if (numerator >= 1000 && numerator <= 9999) return { numerator, denominator };
          }
        } else {
          const denomIsThree = Math.random() < 0.5;
          const denominator = denomIsThree ? randomNumber(true) : randomNumber(false);
          const numerator = Math.round(targetValue * denominator);
          if (numerator >= 100 && numerator <= 9999) return { numerator, denominator };
        }
      }
      return null;
    }
    function generateProblem(difficulty) {
      let frac1, frac2, answer;
      if (difficulty === 'easy') {
        const result1 = generateEasyFraction1();
        frac1 = result1.frac;
        const value1 = result1.value;
        const preset = result1.preset;
        const result2 = generateEasyFraction2(value1);
        frac2 = { numerator: result2.numerator, denominator: result2.denominator };
        answer = (value1 > result2.value) ? "first" : "second";
        return { frac1, frac2, answer, userAnswer: null, difficulty, preset };
      } else {
        do { frac1 = generateFraction(); }
        while (frac1.numerator / frac1.denominator < 0.5 || frac1.numerator / frac1.denominator > 2);
        const fraction2 = generateCloseFractionValue(frac1, difficulty);
        frac2 = { numerator: fraction2.numerator, denominator: fraction2.denominator };
        const val1 = frac1.numerator / frac1.denominator;
        const val2 = frac2.numerator / frac2.denominator;
        answer = (val1 > val2) ? "first" : "second";
        return { frac1, frac2, answer, userAnswer: null, difficulty };
      }
    }
    let problems = [];
    function createFractionButton(fraction, problemIndex, fractionSide) {
      const problem = problems[problemIndex];
      if (problem.difficulty === 'easy' && fractionSide === "first") {
        const btn = document.createElement('div');
        btn.className = 'percentage';
        btn.textContent = problem.preset + "%";
        btn.addEventListener('click', function() {
          selectAnswer(problemIndex, btn, fractionSide);
        });
        return btn;
      } else {
        const btn = document.createElement('div');
        btn.className = 'fraction';
        const numSpan = document.createElement('span');
        numSpan.className = 'numerator';
        numSpan.textContent = fraction.numerator;
        btn.appendChild(numSpan);
        const denSpan = document.createElement('span');
        denSpan.className = 'denominator';
        denSpan.textContent = fraction.denominator;
        btn.appendChild(denSpan);
        btn.addEventListener('click', function() {
          selectAnswer(problemIndex, btn, fractionSide);
        });
        return btn;
      }
    }
    function selectAnswer(problemIndex, btn, fractionSide) {
      const problemDiv = document.getElementById('problem-' + problemIndex);
      const allButtons = problemDiv.querySelectorAll('.fraction, .percentage');
      allButtons.forEach(b => b.classList.remove('selected'));
      btn.classList.add('selected');
      problems[problemIndex].userAnswer = fractionSide;
    }
    function renderProblems() {
      const problemsDiv = document.getElementById('problems');
      problemsDiv.innerHTML = '';
      problems.forEach((problem, index) => {
        const div = document.createElement('div');
        div.className = 'problem';
        div.id = 'problem-' + index;
        const frac1Btn = createFractionButton(problem.frac1, index, "first");
        const frac2Btn = createFractionButton(problem.frac2, index, "second");
        div.appendChild(frac1Btn);
        div.appendChild(frac2Btn);
        problemsDiv.appendChild(div);
      });
    }
    function generateProblems() {
      const difficulty = document.querySelector('input[name="difficulty"]:checked').value;
      problems = [];
      for (let i = 0; i < 15; i++) {
        problems.push(generateProblem(difficulty));
      }
      renderProblems();
      document.getElementById('result').textContent = "";
    }
    function gradeProblems() {
      let correctCount = 0;
      problems.forEach((problem, index) => {
        const problemDiv = document.getElementById('problem-' + index);
        if (problem.userAnswer === problem.answer) {
          correctCount++;
          problemDiv.style.backgroundColor = '#d4edda';
        } else {
          problemDiv.style.backgroundColor = '#f8d7da';
        }
      });
      document.getElementById('result').textContent = "ì •ë‹µ: " + correctCount + " / 15";
    }
    document.getElementById('refresh').addEventListener('click', generateProblems);
    document.getElementById('grade').addEventListener('click', gradeProblems);
    document.querySelectorAll('input[name="difficulty"]').forEach(radio => {
      radio.addEventListener('change', generateProblems);
    });

    /* ---------- ê³±ì…ˆ ì—°ìŠµ í˜ì´ì§€ ìŠ¤í¬ë¦½íŠ¸ (ì¼ì˜ ìë¦¬ ì •ë ¬) ---------- */
    function generateMulProblem() {
      const a = Math.floor(Math.random() * 98) + 2; // 2 ~ 99
      const b = Math.floor(Math.random() * 18) + 2; // 2 ~ 19
      currentProblem = { a, b, answer: a * b };
      displayMulProblem();
    }
    function displayMulProblem() {
      const aStr = currentProblem.a.toString();
      const bStr = currentProblem.b.toString();
      const maxLen = Math.max(aStr.length, bStr.length);
      document.getElementById('lineA').textContent = aStr.padStart(maxLen, ' ');
      document.getElementById('lineB').textContent = bStr.padStart(maxLen, ' ');
      const inputElem = document.getElementById('answer-input');
      inputElem.value = '';
      inputElem.focus();
      document.getElementById('feedback').textContent = '';
    }
    function checkMulAnswer() {
      const inputElem = document.getElementById('answer-input');
      const feedbackElem = document.getElementById('feedback');
      const userAnswer = parseInt(inputElem.value, 10);
      if (userAnswer === currentProblem.answer) {
        feedbackElem.textContent = 'ğŸŸ¢';
        setTimeout(generateMulProblem, 500);
      } else {
        feedbackElem.textContent = 'âŒ';
        inputElem.focus();
      }
    }
    document.getElementById('answer-input').addEventListener('keydown', function(e) {
      if (e.key === 'Enter') {
        checkMulAnswer();
      }
    });
    
    /* í˜ì´ì§€ ë¡œë“œ ì‹œ ê¸°ë³¸ì ìœ¼ë¡œ ë¶„ìˆ˜ ë¹„êµ ì—°ìŠµ í˜ì´ì§€ í‘œì‹œ */
    showFractionPage();
  </script>
</body>
</html>
